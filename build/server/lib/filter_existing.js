// Generated by CoffeeScript 1.10.0
module.exports = function(log, model, suffix, vendor) {
  return function(requiredFields, entries, body, next) {
    entries.filtered = [];
    if ((vendor == null) && entries.fetched.length > 0) {
      vendor = entries.fetched[0].vendor;
    }
    return model.all(function(err, entryObjects) {
      var entry, entryHash, hash, i, len;
      if (err) {
        return next(err);
      }
      entryHash = {};
      for (i = 0, len = entryObjects.length; i < len; i++) {
        entry = entryObjects[i];
        if (vendor != null) {
          if (entry.vendor === vendor) {
            hash = (entry.date.format('YYYY-MM-DD')) + "T00:00:00.000Z";
            entryHash[hash] = entry;
          }
        } else {
          hash = (entry.date.format('YYYY-MM-DD')) + "T00:00:00.000Z";
          entryHash[hash] = entry;
        }
      }
      entries.filtered = entries.fetched.filter(function(entry) {
        hash = (entry.date.format('YYYY-MM-DD')) + "T00:00:00.000Z";
        return entryHash[hash] == null;
      });
      entries.filtered = entries.filtered.filter(function(entry) {
        return entry.vendor === vendor;
      });
      return next();
    });
  };
};
